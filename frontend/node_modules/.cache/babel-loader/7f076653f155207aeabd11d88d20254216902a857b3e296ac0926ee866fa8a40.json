{"ast":null,"code":"import React,{useState,useEffect}from'react';import{dealAPI}from'../../services/dealAPI';import{groupAPI}from'../../services/groupAPI';import{useAuth}from'../../context/AuthContext';import{toast}from'react-toastify';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const MyDeals=()=>{const[myGroups,setMyGroups]=useState([]);const[deals,setDeals]=useState([]);const[loading,setLoading]=useState(true);const{user}=useAuth();useEffect(()=>{const fetchData=async()=>{try{// First get all groups the user is a member of\nconst groupsData=await groupAPI.getMyGroups();setMyGroups(groupsData);// Then get all deals\nconst dealsData=await dealAPI.getAllDeals();// Filter deals to only include those where the user is a member of the group\nconst myGroupIds=groupsData.map(group=>group.id);const myDeals=dealsData.filter(deal=>myGroupIds.includes(deal.group_id));setDeals(myDeals);}catch(error){toast.error(error.detail||'Failed to fetch deals');}finally{setLoading(false);}};if(user&&user.role==='customer'){fetchData();}},[user]);// Function to get group details for a deal\nconst getGroupDetails=groupId=>{return myGroups.find(group=>group.id===groupId)||{};};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center h-64\",children:/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600\"})});}if(deals.length===0){return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow rounded-lg p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mb-4\",children:\"My Deals\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"You don't have any deals yet. When your groups are locked and accepted by sellers, they will appear here.\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white shadow rounded-lg p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-semibold mb-4\",children:\"My Deals\"}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\",children:deals.map(deal=>{var _group$product,_deal$total_amount;const group=getGroupDetails(deal.group_id);return/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border-b bg-gray-50\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"font-medium\",children:[\"Deal #\",deal.id]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"Group #\",deal.group_id]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Product:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:((_group$product=group.product)===null||_group$product===void 0?void 0:_group$product.name)||'N/A'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Total Amount:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[\"\\u20B9\",((_deal$total_amount=deal.total_amount)===null||_deal$total_amount===void 0?void 0:_deal$total_amount.toFixed(2))||'0.00']})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Members:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:deal.total_members||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Status:\"}),/*#__PURE__*/_jsx(\"span\",{className:`px-2 py-1 text-xs font-semibold rounded-full ${deal.status==='completed'?'bg-green-100 text-green-800':deal.status==='cancelled'?'bg-red-100 text-red-800':'bg-yellow-100 text-yellow-800'}`,children:deal.status})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Created:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:new Date(deal.created_at).toLocaleDateString()})]}),deal.completed_at&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Completed:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:new Date(deal.completed_at).toLocaleDateString()})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 border-t\",children:[deal.status==='pending'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-sm text-yellow-600\",children:\"Waiting for seller to complete this deal\"}),deal.status==='completed'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-sm text-green-600\",children:\"Deal completed! You can pick up your order.\"}),deal.status==='cancelled'&&/*#__PURE__*/_jsx(\"div\",{className:\"text-center text-sm text-red-600\",children:\"This deal was cancelled by the seller.\"})]})]},deal.id);})})]});};export default MyDeals;","map":{"version":3,"names":["React","useState","useEffect","dealAPI","groupAPI","useAuth","toast","jsx","_jsx","jsxs","_jsxs","MyDeals","myGroups","setMyGroups","deals","setDeals","loading","setLoading","user","fetchData","groupsData","getMyGroups","dealsData","getAllDeals","myGroupIds","map","group","id","myDeals","filter","deal","includes","group_id","error","detail","role","getGroupDetails","groupId","find","className","children","length","_group$product","_deal$total_amount","product","name","total_amount","toFixed","total_members","status","Date","created_at","toLocaleDateString","completed_at"],"sources":["E:/market_sell/frontend/src/components/customer/MyDeals.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { dealAPI } from '../../services/dealAPI';\nimport { groupAPI } from '../../services/groupAPI';\nimport { useAuth } from '../../context/AuthContext';\nimport { toast } from 'react-toastify';\n\nconst MyDeals = () => {\n  const [myGroups, setMyGroups] = useState([]);\n  const [deals, setDeals] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const { user } = useAuth();\n\n  useEffect(() => {\n    const fetchData = async () => {\n      try {\n        // First get all groups the user is a member of\n        const groupsData = await groupAPI.getMyGroups();\n        setMyGroups(groupsData);\n        \n        // Then get all deals\n        const dealsData = await dealAPI.getAllDeals();\n        \n        // Filter deals to only include those where the user is a member of the group\n        const myGroupIds = groupsData.map(group => group.id);\n        const myDeals = dealsData.filter(deal => myGroupIds.includes(deal.group_id));\n        \n        setDeals(myDeals);\n      } catch (error) {\n        toast.error(error.detail || 'Failed to fetch deals');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    if (user && user.role === 'customer') {\n      fetchData();\n    }\n  }, [user]);\n\n  // Function to get group details for a deal\n  const getGroupDetails = (groupId) => {\n    return myGroups.find(group => group.id === groupId) || {};\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center items-center h-64\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-600\"></div>\n      </div>\n    );\n  }\n\n  if (deals.length === 0) {\n    return (\n      <div className=\"bg-white shadow rounded-lg p-6 mb-6\">\n        <h2 className=\"text-xl font-semibold mb-4\">My Deals</h2>\n        <p className=\"text-gray-500\">You don't have any deals yet. When your groups are locked and accepted by sellers, they will appear here.</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"bg-white shadow rounded-lg p-6 mb-6\">\n      <h2 className=\"text-xl font-semibold mb-4\">My Deals</h2>\n      \n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {deals.map((deal) => {\n          const group = getGroupDetails(deal.group_id);\n          return (\n            <div key={deal.id} className=\"border rounded-lg overflow-hidden shadow-sm hover:shadow-md transition-shadow\">\n              <div className=\"p-4 border-b bg-gray-50\">\n                <h3 className=\"font-medium\">Deal #{deal.id}</h3>\n                <p className=\"text-sm text-gray-500\">Group #{deal.group_id}</p>\n              </div>\n              \n              <div className=\"p-4\">\n                <div className=\"flex justify-between mb-2\">\n                  <span className=\"text-gray-600\">Product:</span>\n                  <span className=\"font-medium\">{group.product?.name || 'N/A'}</span>\n                </div>\n                \n                <div className=\"flex justify-between mb-2\">\n                  <span className=\"text-gray-600\">Total Amount:</span>\n                  <span className=\"font-medium\">â‚¹{deal.total_amount?.toFixed(2) || '0.00'}</span>\n                </div>\n                \n                <div className=\"flex justify-between mb-2\">\n                  <span className=\"text-gray-600\">Members:</span>\n                  <span className=\"font-medium\">{deal.total_members || 0}</span>\n                </div>\n                \n                <div className=\"flex justify-between mb-2\">\n                  <span className=\"text-gray-600\">Status:</span>\n                  <span className={`px-2 py-1 text-xs font-semibold rounded-full ${\n                    deal.status === 'completed' ? 'bg-green-100 text-green-800' : \n                    deal.status === 'cancelled' ? 'bg-red-100 text-red-800' : \n                    'bg-yellow-100 text-yellow-800'\n                  }`}>\n                    {deal.status}\n                  </span>\n                </div>\n                \n                <div className=\"flex justify-between mb-2\">\n                  <span className=\"text-gray-600\">Created:</span>\n                  <span className=\"font-medium\">{new Date(deal.created_at).toLocaleDateString()}</span>\n                </div>\n                \n                {deal.completed_at && (\n                  <div className=\"flex justify-between mb-2\">\n                    <span className=\"text-gray-600\">Completed:</span>\n                    <span className=\"font-medium\">{new Date(deal.completed_at).toLocaleDateString()}</span>\n                  </div>\n                )}\n              </div>\n              \n              <div className=\"p-4 bg-gray-50 border-t\">\n                {deal.status === 'pending' && (\n                  <div className=\"text-center text-sm text-yellow-600\">\n                    Waiting for seller to complete this deal\n                  </div>\n                )}\n                \n                {deal.status === 'completed' && (\n                  <div className=\"text-center text-sm text-green-600\">\n                    Deal completed! You can pick up your order.\n                  </div>\n                )}\n                \n                {deal.status === 'cancelled' && (\n                  <div className=\"text-center text-sm text-red-600\">\n                    This deal was cancelled by the seller.\n                  </div>\n                )}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport default MyDeals;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}