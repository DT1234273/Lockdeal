{"ast":null,"code":"var _jsxFileName = \"E:\\\\market_sell\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { createContext, useContext, useEffect, useState } from 'react';\nimport axios from '../services/axiosConfig';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport const useAuth = () => {\n  _s();\n  return useContext(AuthContext);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [tempEmail, setTempEmail] = useState('');\n  const fetchUserProfile = async () => {\n    try {\n      const response = await axios.get('/api/auth/profile');\n      return response.data;\n    } catch (error) {\n      var _error$response;\n      throw ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data) || {\n        detail: 'An error occurred while fetching user profile'\n      };\n    }\n  };\n  useEffect(() => {\n    // Check if user is already logged in\n    const token = localStorage.getItem('token');\n    const userData = localStorage.getItem('user');\n    if (token && userData) {\n      const parsedUserData = JSON.parse(userData);\n      setUser(parsedUserData);\n      setIsAuthenticated(true);\n\n      // Fetch complete user profile if we have a token\n      if (parsedUserData && parsedUserData.id) {\n        fetchUserProfile().then(profileData => {\n          // Update user data with complete profile\n          const updatedUserData = {\n            ...parsedUserData,\n            ...profileData\n          };\n          setUser(updatedUserData);\n          localStorage.setItem('user', JSON.stringify(updatedUserData));\n        }).catch(error => {\n          console.error('Failed to fetch user profile:', error);\n        });\n      }\n\n      // Token is handled by axios interceptors in axiosConfig.js\n    }\n    setLoading(false);\n  }, []);\n  const login = async (email, password) => {\n    try {\n      const response = await axios.post('/api/auth/login', {\n        email,\n        password\n      });\n      setTempEmail(email);\n      return response.data;\n    } catch (error) {\n      var _error$response2;\n      throw ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.data) || {\n        detail: 'An error occurred during login'\n      };\n    }\n  };\n  const register = async userData => {\n    try {\n      const response = await axios.post('/api/auth/register', userData);\n      setTempEmail(userData.email);\n      return response.data;\n    } catch (error) {\n      var _error$response3;\n      throw ((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.data) || {\n        detail: 'An error occurred during registration'\n      };\n    }\n  };\n  const resendOTP = async email => {\n    try {\n      const response = await axios.post('/api/auth/resend-otp', {\n        email\n      });\n      return response.data;\n    } catch (error) {\n      var _error$response4;\n      throw ((_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.data) || {\n        detail: 'An error occurred while resending OTP'\n      };\n    }\n  };\n  const verifyOTP = async (email, otp_code) => {\n    try {\n      const response = await axios.post('/api/auth/verify-otp', {\n        email,\n        otp_code\n      });\n      const {\n        access_token,\n        user_id,\n        role\n      } = response.data;\n\n      // Save token and user data\n      localStorage.setItem('token', access_token);\n      const userData = {\n        id: user_id,\n        email,\n        role\n      };\n      localStorage.setItem('user', JSON.stringify(userData));\n\n      // Set user in state\n      setUser(userData);\n      setIsAuthenticated(true);\n\n      // Token is handled by axios interceptors in axiosConfig.js\n\n      // Fetch complete user profile after successful login\n      try {\n        const profileData = await fetchUserProfile();\n        const updatedUserData = {\n          ...userData,\n          ...profileData\n        };\n        setUser(updatedUserData);\n        localStorage.setItem('user', JSON.stringify(updatedUserData));\n      } catch (profileError) {\n        console.error('Failed to fetch user profile:', profileError);\n      }\n      return response.data;\n    } catch (error) {\n      var _error$response5;\n      throw ((_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : _error$response5.data) || {\n        detail: 'An error occurred during OTP verification'\n      };\n    }\n  };\n  const logout = () => {\n    // Remove token and user data\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n\n    // Reset state\n    setUser(null);\n    setIsAuthenticated(false);\n\n    // Token removal is handled by axios interceptors in axiosConfig.js\n  };\n  const registerSeller = async sellerData => {\n    try {\n      const response = await axios.post(`/api/auth/register-seller?user_id=${user.id}`, sellerData);\n      return response.data;\n    } catch (error) {\n      var _error$response6;\n      throw ((_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : _error$response6.data) || {\n        detail: 'An error occurred during seller registration'\n      };\n    }\n  };\n  const paySellerFee = async () => {\n    try {\n      const response = await axios.post(`/api/auth/pay-seller-fee/${user.id}`);\n      return response.data;\n    } catch (error) {\n      var _error$response7;\n      throw ((_error$response7 = error.response) === null || _error$response7 === void 0 ? void 0 : _error$response7.data) || {\n        detail: 'An error occurred during payment'\n      };\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      isAuthenticated,\n      loading,\n      tempEmail,\n      login,\n      register,\n      verifyOTP,\n      resendOTP,\n      logout,\n      registerSeller,\n      paySellerFee,\n      fetchUserProfile,\n      setTempEmail\n    },\n    children: !loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 145,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"4dHh2xOappcr4Pwr3FUHs6mMoN0=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["createContext","useContext","useEffect","useState","axios","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","AuthProvider","children","_s2","user","setUser","isAuthenticated","setIsAuthenticated","loading","setLoading","tempEmail","setTempEmail","fetchUserProfile","response","get","data","error","_error$response","detail","token","localStorage","getItem","userData","parsedUserData","JSON","parse","id","then","profileData","updatedUserData","setItem","stringify","catch","console","login","email","password","post","_error$response2","register","_error$response3","resendOTP","_error$response4","verifyOTP","otp_code","access_token","user_id","role","profileError","_error$response5","logout","removeItem","registerSeller","sellerData","_error$response6","paySellerFee","_error$response7","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["E:/market_sell/frontend/src/context/AuthContext.js"],"sourcesContent":["import { createContext, useContext, useEffect, useState } from 'react';\nimport axios from '../services/axiosConfig';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [isAuthenticated, setIsAuthenticated] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [tempEmail, setTempEmail] = useState('');\n  \n  const fetchUserProfile = async () => {\n    try {\n      const response = await axios.get('/api/auth/profile');\n      return response.data;\n    } catch (error) {\n      throw error.response?.data || { detail: 'An error occurred while fetching user profile' };\n    }\n  };\n  \n  useEffect(() => {\n    // Check if user is already logged in\n    const token = localStorage.getItem('token');\n    const userData = localStorage.getItem('user');\n    \n    if (token && userData) {\n      const parsedUserData = JSON.parse(userData);\n      setUser(parsedUserData);\n      setIsAuthenticated(true);\n      \n      // Fetch complete user profile if we have a token\n      if (parsedUserData && parsedUserData.id) {\n        fetchUserProfile()\n          .then(profileData => {\n            // Update user data with complete profile\n            const updatedUserData = { ...parsedUserData, ...profileData };\n            setUser(updatedUserData);\n            localStorage.setItem('user', JSON.stringify(updatedUserData));\n          })\n          .catch(error => {\n            console.error('Failed to fetch user profile:', error);\n          });\n      }\n      \n      // Token is handled by axios interceptors in axiosConfig.js\n    }\n    \n    setLoading(false);\n  }, []);\n  \n  const login = async (email, password) => {\n    try {\n      const response = await axios.post('/api/auth/login', { email, password });\n      setTempEmail(email);\n      return response.data;\n    } catch (error) {\n      throw error.response?.data || { detail: 'An error occurred during login' };\n    }\n  };\n  \n  const register = async (userData) => {\n    try {\n      const response = await axios.post('/api/auth/register', userData);\n      setTempEmail(userData.email);\n      return response.data;\n    } catch (error) {\n      throw error.response?.data || { detail: 'An error occurred during registration' };\n    }\n  };\n  \n  const resendOTP = async (email) => {\n    try {\n      const response = await axios.post('/api/auth/resend-otp', { email });\n      return response.data;\n    } catch (error) {\n      throw error.response?.data || { detail: 'An error occurred while resending OTP' };\n    }\n  };\n\n  const verifyOTP = async (email, otp_code) => {\n    try {\n      const response = await axios.post('/api/auth/verify-otp', { email, otp_code });\n      const { access_token, user_id, role } = response.data;\n      \n      // Save token and user data\n      localStorage.setItem('token', access_token);\n      const userData = { id: user_id, email, role };\n      localStorage.setItem('user', JSON.stringify(userData));\n      \n      // Set user in state\n      setUser(userData);\n      setIsAuthenticated(true);\n      \n      // Token is handled by axios interceptors in axiosConfig.js\n      \n      // Fetch complete user profile after successful login\n      try {\n        const profileData = await fetchUserProfile();\n        const updatedUserData = { ...userData, ...profileData };\n        setUser(updatedUserData);\n        localStorage.setItem('user', JSON.stringify(updatedUserData));\n      } catch (profileError) {\n        console.error('Failed to fetch user profile:', profileError);\n      }\n      \n      return response.data;\n    } catch (error) {\n      throw error.response?.data || { detail: 'An error occurred during OTP verification' };\n    }\n  };\n  \n  const logout = () => {\n    // Remove token and user data\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    \n    // Reset state\n    setUser(null);\n    setIsAuthenticated(false);\n    \n    // Token removal is handled by axios interceptors in axiosConfig.js\n  };\n  \n  const registerSeller = async (sellerData) => {\n    try {\n      const response = await axios.post(`/api/auth/register-seller?user_id=${user.id}`, sellerData);\n      return response.data;\n    } catch (error) {\n      throw error.response?.data || { detail: 'An error occurred during seller registration' };\n    }\n  };\n  \n  const paySellerFee = async () => {\n    try {\n      const response = await axios.post(`/api/auth/pay-seller-fee/${user.id}`);\n      return response.data;\n    } catch (error) {\n      throw error.response?.data || { detail: 'An error occurred during payment' };\n    }\n  };\n  \n  return (\n    <AuthContext.Provider\n      value={{\n        user,\n        isAuthenticated,\n        loading,\n        tempEmail,\n        login,\n        register,\n        verifyOTP,\n        resendOTP,\n        logout,\n        registerSeller,\n        paySellerFee,\n        fetchUserProfile,\n        setTempEmail\n      }}\n    >\n      {!loading && children}\n    </AuthContext.Provider>\n  );\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}