{"ast":null,"code":"import{ErrorMessage,Field,Form,Formik}from'formik';import{useEffect,useState}from'react';import{useNavigate}from'react-router-dom';import{toast}from'react-toastify';import*as Yup from'yup';import{useAuth}from'../context/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const OTPSchema=Yup.object().shape({otp:Yup.string().required('OTP is required').matches(/^[0-9]{6}$/,'OTP must be 6 digits')});const OTPVerification=()=>{const{verifyOTP,resendOTP,tempEmail,user}=useAuth();const navigate=useNavigate();const[isSubmitting,setIsSubmitting]=useState(false);const[timer,setTimer]=useState(300);// 5 minutes in seconds\nuseEffect(()=>{// Redirect if no email in context\nif(!tempEmail){toast.error('Please login first');navigate('/login');return;}// Redirect if already verified\nif(user&&user.is_verified){const redirectPath=user.role==='seller'?'/seller/dashboard':'/customer/dashboard';navigate(redirectPath);return;}// Set up countdown timer\nconst countdown=setInterval(()=>{setTimer(prevTimer=>{if(prevTimer<=1){clearInterval(countdown);return 0;}return prevTimer-1;});},1000);return()=>clearInterval(countdown);},[tempEmail,user,navigate]);const handleSubmit=async values=>{setIsSubmitting(true);try{await verifyOTP(tempEmail,values.otp);toast.success('OTP verified successfully');// Redirect based on user role\nconst redirectPath=user.role==='seller'?'/seller/dashboard':'/customer/dashboard';navigate(redirectPath);}catch(error){toast.error(error.detail||'OTP verification failed');}finally{setIsSubmitting(false);}};const formatTime=seconds=>{const mins=Math.floor(seconds/60);const secs=seconds%60;return\"\".concat(mins,\":\").concat(secs<10?'0':'').concat(secs);};const handleResendOTP=async()=>{try{await resendOTP(tempEmail);toast.info('OTP resent to your email');setTimer(300);// Reset timer\n}catch(error){toast.error(error.detail||'Failed to resend OTP');}};return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md w-full space-y-8\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"mt-6 text-center text-3xl font-extrabold text-gray-900\",children:\"LockDeal\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-2 text-center text-sm text-gray-600\",children:\"Buy Together, Save Smartly \\u2013 Local Pickup, No Delivery\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8 bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-6\",children:\"Verify OTP\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"mb-4 text-sm text-gray-600\",children:[\"We've sent a 6-digit OTP to \",/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:tempEmail}),\". Please enter it below to verify your account.\"]}),/*#__PURE__*/_jsx(Formik,{initialValues:{otp:''},validationSchema:OTPSchema,onSubmit:handleSubmit,children:_ref=>{let{errors,touched}=_ref;return/*#__PURE__*/_jsxs(Form,{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"otp\",className:\"form-label\",children:\"Enter 6-digit OTP\"}),/*#__PURE__*/_jsx(Field,{id:\"otp\",name:\"otp\",type:\"text\",maxLength:\"6\",className:\"form-input text-center text-2xl tracking-widest\",placeholder:\"------\"}),/*#__PURE__*/_jsx(ErrorMessage,{name:\"otp\",component:\"div\",className:\"form-error\"})]}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn-primary w-full\",disabled:isSubmitting||timer===0,children:isSubmitting?'Verifying...':'Verify OTP'})})]});}}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-6 text-center\",children:/*#__PURE__*/_jsx(\"button\",{onClick:handleResendOTP,disabled:timer>0,className:\"text-sm font-medium \".concat(timer>0?'text-gray-400':'text-primary-600 hover:text-primary-500'),children:timer>0?\"Resend OTP in \".concat(formatTime(timer)):'Resend OTP'})})]})]})});};export default OTPVerification;","map":{"version":3,"names":["ErrorMessage","Field","Form","Formik","useEffect","useState","useNavigate","toast","Yup","useAuth","jsx","_jsx","jsxs","_jsxs","OTPSchema","object","shape","otp","string","required","matches","OTPVerification","verifyOTP","resendOTP","tempEmail","user","navigate","isSubmitting","setIsSubmitting","timer","setTimer","error","is_verified","redirectPath","role","countdown","setInterval","prevTimer","clearInterval","handleSubmit","values","success","detail","formatTime","seconds","mins","Math","floor","secs","concat","handleResendOTP","info","className","children","initialValues","validationSchema","onSubmit","_ref","errors","touched","htmlFor","id","name","type","maxLength","placeholder","component","disabled","onClick"],"sources":["E:/lockdeal/frontend/src/pages/OTPVerification.js"],"sourcesContent":["import { ErrorMessage, Field, Form, Formik } from 'formik';\nimport { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { toast } from 'react-toastify';\nimport * as Yup from 'yup';\nimport { useAuth } from '../context/AuthContext';\n\nconst OTPSchema = Yup.object().shape({\n  otp: Yup.string()\n    .required('OTP is required')\n    .matches(/^[0-9]{6}$/, 'OTP must be 6 digits'),\n});\n\nconst OTPVerification = () => {\n  const { verifyOTP, resendOTP, tempEmail, user } = useAuth();\n  const navigate = useNavigate();\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [timer, setTimer] = useState(300); // 5 minutes in seconds\n\n  useEffect(() => {\n    // Redirect if no email in context\n    if (!tempEmail) {\n      toast.error('Please login first');\n      navigate('/login');\n      return;\n    }\n\n    // Redirect if already verified\n    if (user && user.is_verified) {\n      const redirectPath = user.role === 'seller' ? '/seller/dashboard' : '/customer/dashboard';\n      navigate(redirectPath);\n      return;\n    }\n\n    // Set up countdown timer\n    const countdown = setInterval(() => {\n      setTimer((prevTimer) => {\n        if (prevTimer <= 1) {\n          clearInterval(countdown);\n          return 0;\n        }\n        return prevTimer - 1;\n      });\n    }, 1000);\n\n    return () => clearInterval(countdown);\n  }, [tempEmail, user, navigate]);\n\n  const handleSubmit = async (values) => {\n    setIsSubmitting(true);\n    try {\n      await verifyOTP(tempEmail, values.otp);\n      toast.success('OTP verified successfully');\n      \n      // Redirect based on user role\n      const redirectPath = user.role === 'seller' ? '/seller/dashboard' : '/customer/dashboard';\n      navigate(redirectPath);\n    } catch (error) {\n      toast.error(error.detail || 'OTP verification failed');\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const formatTime = (seconds) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;\n  };\n\n  const handleResendOTP = async () => {\n    try {\n      await resendOTP(tempEmail);\n      toast.info('OTP resent to your email');\n      setTimer(300); // Reset timer\n    } catch (error) {\n      toast.error(error.detail || 'Failed to resend OTP');\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8\">\n      <div className=\"max-w-md w-full space-y-8\">\n        <div>\n          <h2 className=\"mt-6 text-center text-3xl font-extrabold text-gray-900\">LockDeal</h2>\n          <p className=\"mt-2 text-center text-sm text-gray-600\">\n            Buy Together, Save Smartly â€“ Local Pickup, No Delivery\n          </p>\n        </div>\n        <div className=\"mt-8 bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10\">\n          <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">Verify OTP</h2>\n          <p className=\"mb-4 text-sm text-gray-600\">\n            We've sent a 6-digit OTP to <span className=\"font-medium\">{tempEmail}</span>.\n            Please enter it below to verify your account.\n          </p>\n          \n          <Formik\n            initialValues={{ otp: '' }}\n            validationSchema={OTPSchema}\n            onSubmit={handleSubmit}\n          >\n            {({ errors, touched }) => (\n              <Form className=\"space-y-6\">\n                <div>\n                  <label htmlFor=\"otp\" className=\"form-label\">\n                    Enter 6-digit OTP\n                  </label>\n                  <Field\n                    id=\"otp\"\n                    name=\"otp\"\n                    type=\"text\"\n                    maxLength=\"6\"\n                    className=\"form-input text-center text-2xl tracking-widest\"\n                    placeholder=\"------\"\n                  />\n                  <ErrorMessage name=\"otp\" component=\"div\" className=\"form-error\" />\n                </div>\n\n                \n\n                <div>\n                  <button\n                    type=\"submit\"\n                    className=\"btn-primary w-full\"\n                    disabled={isSubmitting || timer === 0}\n                  >\n                    {isSubmitting ? 'Verifying...' : 'Verify OTP'}\n                  </button>\n                </div>\n              </Form>\n            )}\n          </Formik>\n\n          <div className=\"mt-6 text-center\">\n            <button\n              onClick={handleResendOTP}\n              disabled={timer > 0}\n              className={`text-sm font-medium ${timer > 0 ? 'text-gray-400' : 'text-primary-600 hover:text-primary-500'}`}\n            >\n              {timer > 0 ? `Resend OTP in ${formatTime(timer)}` : 'Resend OTP'}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default OTPVerification;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}